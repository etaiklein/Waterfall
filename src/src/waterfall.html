<!DOCTYPE html>
<!-- /**
 waterfall.html
 displays a filmstrip of images with a connected data waterfall  
 
 @author Etai Klein
 Keynote Systems Intern
 
  Last modified 12/18/13

-->

<html lang"en">
  <body>
  	   <meta charset="utf-8">

    <title>...</title>
    	<script type="text/javascript" src="../external/jquery-2.0.2.min.js"></script>

    <script type="text/javascript" src="../external/waterfall.js"></script>
    
	<script type="text/javascript" id="key" src="./Data/key.js"></script>

     <link rel="stylesheet" type="text/css" href="waterfall.css" /> 

<script src="../external/js/highcharts.js"></script>
<script src="../external/js/highcharts-more.js"></script>
<script src="../external/js/modules/exporting.js"></script>
	
	<div id="bigcontainer">
	
	<!-- creates and loads images into scrolling filmstrip -->
	
	<div class="media" id="media">
    <div class="imageContainer"> 
	<script type="text/javascript" id="images" src="./Data/images.js"></script>
  	</div>
  	</div>
  
  <!-- Todo: programmatically add divs if possible -->
  <!-- Waterfall containers-->
  
  <div id="container0" class= "container"></div>
  <div id="container1" class= "container"></div>
  <div id="container2" class= "container"></div>
  <div id="container3" class= "container"></div>
  <div id="container4" class= "container"></div>
  <div id="container5" class= "container"></div>
  <div id="container6" class= "container"></div>
  <div id="container7" class= "container"></div>
  <div id="container8" class= "container"></div>
  <div id="container9" class= "container"></div>
  <div id="container10" class= "container"></div>
  <div id="container11" class= "container"></div>
  <div id="container12" class= "container"></div>
  <div id="container13" class= "container"></div>
  <div id="container14" class= "container"></div>
  <div id="container15" class= "container"></div>
  <div id="container16" class= "container"></div>


	<!--script to show/hide the waterfalls at a given scroll position
	var outnames - the names of the files containing the waterfalls
	scrollPercent - Percent of the image container scrolled through
	starttimes - the time each waterfall starts
	endtimes - the time each waterfall ends
	-->
	<script type="text/javascript" >
	var length = outnames.length;
	var index;
	
  //Todo: programmatically add scripts if possible
  // Waterfall containers

	document.writeln("<script type=\"text/javascript\" src="+outnames[0]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[1]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[2]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[3]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[4]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[5]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[6]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[7]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[8]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[9]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[10]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[11]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[12]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[13]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[14]+"\>\</script\>");
	document.writeln("<script type=\"text/javascript\" src="+outnames[15]+"\>\</script\>");


	var i = 0;
	var hi = 0;
	
	$(document).ready(function(){

                setInterval(function() {

 
			        var element = document.getElementById('media');
			        style = window.getComputedStyle(element);
			        var scrollPercent = ((element.scrollLeft) / (element.scrollWidth - element.clientWidth + .001));
			        var startPercent = (starttimes[i] / endtimes[length-1]);
        			var endPercent = (endtimes[i] / endtimes[length-1]);
        			var calculatedPercent = (scrollPercent - startPercent)/(endPercent - startPercent);
										
					
					//if we scroll past the beginning of a waterfall, switch it out for the previous
					if (calculatedPercent < 0){
						if (i != 0){
     						$('#container'+(i).toString()).hide();
     						$('#container' +(i-1).toString()).show();
     					    console.log("moved down" + (i-1).toString());
						i = i - 1;
													}
					}
					//if we scroll past the end of a waterfall, switch it out for the next
					if (calculatedPercent >= 1){
						if (i != length-1){
							i = i + 1;
     						$('#container'+(i-1).toString()).hide();
     						$('#container' +(i).toString()).show();
							console.log("moved up"+ i.toString());

						}
					}
					
					
                }, 100);
            });
		
	</script>
</div>
  </body>
</html>